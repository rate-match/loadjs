!function(){let e="https://loadjs.rate-match.com/api/log/error",t="https://loadjs.rate-match.com/api/log/api",n=[];function o(){let e=localStorage.getItem("waf_token");return e||(e=crypto.randomUUID(),localStorage.setItem("waf_token",e)),e}function r(){if(0===n.length)return;let e=JSON.stringify(n);navigator.sendBeacon?navigator.sendBeacon(t,e):fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:e}).catch(e=>console.warn("Fallback  api failed",e)),n=[]}function a(e){n.push(e),n.length>=5&&r()}setInterval(r,5e3),window.addEventListener("error",function(t){let n=t,r=n.error&&n.error.stack?n.error.stack:`${n.filename}:${n.lineno}:${n.colno}`,a={type:"runtimeError",message:n.message||"",stack:r||"No stack available",source:n.filename||"",lineno:n.lineno||0,colno:n.colno||0,url:window.location.href,user_agent:navigator.userAgent,timestamp:new Date().toISOString(),token:o()};navigator.sendBeacon?navigator.sendBeacon(e,JSON.stringify(a)):fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).catch(e=>console.warn("Fallback error  failed",e))}),window.addEventListener("unhandledrejection",function(t){let n=t.reason||{},r={type:"unhandledRejection",message:n.message||String(n),stack:n.stack||"No stack available",url:window.location.href,user_agent:navigator.userAgent,timestamp:new Date().toISOString(),token:o()};navigator.sendBeacon?navigator.sendBeacon(e,JSON.stringify(r)):fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).catch(e=>console.warn("Fallback error  failed",e))}),function(){let t=console.error;console.error=function(...n){t.apply(console,n);let o=e=>{if("string"==typeof e)return e;if(e instanceof Error)return e.message+"\n"+e.stack;try{return JSON.stringify(e)}catch{return String(e)}},r=n.map(o).join(" | "),a={type:"consoleError",message:r,url:window.location.href,user_agent:navigator.userAgent,timestamp:new Date().toISOString(),token:localStorage.getItem("waf_token")||"no_token"};navigator.sendBeacon?navigator.sendBeacon(e,JSON.stringify(a)):fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).catch(console.warn)}}();let s=window.fetch;window.fetch=async function(...e){let[t,n]=e,o=n&&n.method||"GET",r="string"==typeof t?t:t.url,i=performance.now();try{let c=await s(...e),l=performance.now()-i;if(l>500){let p={type:"apiRequest",method:o,url:r,status:c.status,response_time_ms:parseFloat(l.toFixed(2)),user_agent:navigator.userAgent,timestamp:new Date().toISOString()};a(p)}return c}catch(u){let d=performance.now()-i,g={type:"apiError",method:o,url:r,error:u.message,response_time_ms:parseFloat(d.toFixed(2)),user_agent:navigator.userAgent,timestamp:new Date().toISOString()};throw a(g),u}},function(){let e=XMLHttpRequest.prototype.open,t=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(t,n){return this._logData={method:t,url:n},e.apply(this,arguments)},XMLHttpRequest.prototype.send=function(e){let n=this,r=performance.now();return n.addEventListener("loadend",function(){let e=performance.now()-r;if(e>500){let t={type:"xhrRequest",method:n._logData.method,url:n._logData.url,status:n.status,response_time_ms:parseFloat(e.toFixed(2)),user_agent:navigator.userAgent,timestamp:new Date().toISOString(),token:o()};a(t)}}),t.apply(this,arguments)}}()}();

!function(){const t="https://loadjs.rate-match.com/api/log/error",e="https://loadjs.rate-match.com/api/log/api";let n=[];function o(){let t=localStorage.getItem("waf_token");return t||(t=crypto.randomUUID(),localStorage.setItem("waf_token",t)),t}function a(){if(0===n.length)return;const t=JSON.stringify(n);navigator.sendBeacon?navigator.sendBeacon(e,t):fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:t}).catch((t=>console.warn("Fallback  api failed",t))),n=[]}function r(t){n.push(t),n.length>=5&&a()}setInterval(a,5e3),window.addEventListener("error",(function(e){const n=e,a={type:"runtimeError",message:n.message||"",stack:n.error?.stack||"No stack available",source:n.filename||"",lineno:n.lineno||0,colno:n.colno||0,url:window.location.href,user_agent:navigator.userAgent,timestamp:(new Date).toISOString(),token:o()};navigator.sendBeacon?navigator.sendBeacon(t,JSON.stringify(a)):fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).catch((t=>console.warn("Fallback error  failed",t)))})),window.addEventListener("unhandledrejection",(function(e){const n=e.reason||{},a={type:"unhandledRejection",message:n.message||String(n),stack:n.stack||"No stack available",url:window.location.href,user_agent:navigator.userAgent,timestamp:(new Date).toISOString(),token:o()};navigator.sendBeacon?navigator.sendBeacon(t,JSON.stringify(a)):fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).catch((t=>console.warn("Fallback error  failed",t)))})),function(){const e=console.error;console.error=function(...n){e.apply(console,n);const a={type:"consoleError",message:n.map((t=>t?.stack||t?.message||String(t))).join(" | "),url:window.location.href,user_agent:navigator.userAgent,timestamp:(new Date).toISOString(),token:o()};navigator.sendBeacon?navigator.sendBeacon(t,JSON.stringify(a)):fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).catch(console.warn)}}();const s=window.fetch;window.fetch=async function(...t){const[e,n]=t,o=n&&n.method||"GET",a="string"==typeof e?e:e.url,i=performance.now();try{const e=await s(...t),n=performance.now()-i;if(n>500){r({type:"apiRequest",method:o,url:a,status:e.status,response_time_ms:parseFloat(n.toFixed(2)),user_agent:navigator.userAgent,timestamp:(new Date).toISOString()})}return e}catch(t){const e=performance.now()-i;throw r({type:"apiError",method:o,url:a,error:t.message,response_time_ms:parseFloat(e.toFixed(2)),user_agent:navigator.userAgent,timestamp:(new Date).toISOString()}),t}},function(){const t=XMLHttpRequest.prototype.open,e=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(e,n){return this._logData={method:e,url:n},t.apply(this,arguments)},XMLHttpRequest.prototype.send=function(t){const n=this,a=performance.now();return n.addEventListener("loadend",(function(){const t=performance.now()-a;if(t>500){r({type:"xhrRequest",method:n._logData.method,url:n._logData.url,status:n.status,response_time_ms:parseFloat(t.toFixed(2)),user_agent:navigator.userAgent,timestamp:(new Date).toISOString(),token:o()})}})),e.apply(this,arguments)}}()}();
